<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug Combo CSV Direct</title>
</head>
<body>
    <h1>üîç Debug: Pourquoi la combo est vide ?</h1>
    <div id="results"></div>
    
    <!-- Test direct sans application compl√®te -->
    <script src="src/services/csv-data-source-simple.js"></script>
    <script>
        console.log('üîç DEBUG: Starting direct investigation...');
        
        window.addEventListener('load', async function() {
            const results = document.getElementById('results');
            
            // Test 1: Service CSV disponible ?
            console.log('1Ô∏è‚É£ V√©rification service CSV...');
            results.innerHTML += '<h3>1Ô∏è‚É£ Service CSV</h3>';
            
            if (window.csvDataSourceService) {
                console.log('‚úÖ Service CSV trouv√©');
                results.innerHTML += '<p>‚úÖ Service CSV disponible</p>';
                
                try {
                    // Test 2: D√©couverte des sources
                    console.log('2Ô∏è‚É£ Test d√©couverte sources...');
                    results.innerHTML += '<h3>2Ô∏è‚É£ D√©couverte Sources</h3>';
                    
                    const sources = await window.csvDataSourceService.discoverCSVSources();
                    console.log('Sources d√©couvertes:', sources.length, sources);
                    
                    if (sources.length > 0) {
                        results.innerHTML += `<p>‚úÖ ${sources.length} sources trouv√©es:</p><ul>`;
                        sources.forEach(source => {
                            results.innerHTML += `<li>${source.fileName} - ${source.name}</li>`;
                        });
                        results.innerHTML += '</ul>';
                    } else {
                        results.innerHTML += '<p>‚ùå Aucune source trouv√©e!</p>';
                    }
                    
                    // Test 3: Feeding panel mock
                    console.log('3Ô∏è‚É£ Test feeding panel mock...');
                    results.innerHTML += '<h3>3Ô∏è‚É£ Test Feeding Panel Mock</h3>';
                    
                    // Cr√©er une combo de test
                    const testSelect = document.createElement('select');
                    testSelect.style.width = '300px';
                    testSelect.style.padding = '8px';
                    
                    // Fonction mock de renderDataSourceOptions
                    function mockRenderDataSourceOptions() {
                        if (sources.length === 0) {
                            return `<option value="" disabled selected>No data sources found</option>`;
                        }
                        
                        let options = '<option value="" selected>Select a data source...</option>';
                        sources.forEach(source => {
                            options += `<option value="${source.fileName}">${source.name} (${source.rowCount || 'Unknown'} rows)</option>`;
                        });
                        
                        return options;
                    }
                    
                    testSelect.innerHTML = mockRenderDataSourceOptions();
                    
                    results.appendChild(document.createElement('br'));
                    results.appendChild(document.createTextNode('Test combo: '));
                    results.appendChild(testSelect);
                    
                    if (testSelect.options.length > 1) {
                        results.innerHTML += '<p>‚úÖ Combo fonctionnelle avec options!</p>';
                    } else {
                        results.innerHTML += '<p>‚ùå Combo vide malgr√© les sources!</p>';
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erreur:', error);
                    results.innerHTML += `<p>‚ùå Erreur: ${error.message}</p>`;
                }
            } else {
                console.log('‚ùå Service CSV NON trouv√©');
                results.innerHTML += '<p>‚ùå Service CSV non disponible</p>';
            }
        });
    </script>
</body>
</html>